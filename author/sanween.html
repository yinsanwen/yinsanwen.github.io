<!DOCTYPE html>
<html lang="cn">
<head>
        <meta charset="utf-8" />
        <title>sanwen's blog - sanween</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">sanwen's blog </a></h1>
                <nav><ul>
                    <li><a href="/category/j2ee.html">j2EE</a></li>
                    <li><a href="/category/java-web.html">Java Web</a></li>
                    <li><a href="/category/python.html">Python</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/build-REST-Web-Service-use-Spring-and-Apahce-CXF.html">利用Spring和Apache CXF构建REST Web Service</a></h1>
<footer class="post-info">
        <abbr class="published" title="2014-03-20T20:53:00">
                Published: 四 20 三月 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/sanween.html">sanween</a>
        </address>
<p>In <a href="/category/j2ee.html">j2EE</a>. </p>
<p>tags: <a href="/tag/jax-rs.html">jax-rs</a> <a href="/tag/rest.html">rest</a> <a href="/tag/cxf.html">cxf</a> </p>
</footer><!-- /.post-info --><p>首先说一说JAX-RS，直接引用wiki上面的说明。</p>
<blockquote>
<p><strong>JAX-RS: Java API for RESTful Web Services</strong>是一个Java编程语言的应用程序接口,支持按照<strong>表象化状态转变</strong>(REST)架构风格创建Web服务. JAX-RS使用了Java SE 5引入的Java 标注来简化Web服务客户端和服务端的开发和部署。</p>
</blockquote>
<p>在J2EE 6中，已经引入对了JAX-RS的支持。在我的理解中，JAX-RS和JSR-311表示的是同一个标准规范。</p>
<p>而JAX-RS标准规范有多种不同的实现。主要包括<br />
Apache CXF, 开源的Web服务框架。<br />
Jersey, 由Sun提供的JAX-RS的参考实现<br />
RESTEasy，JBoss的实现<br />
Restlet，由Jerome Louvel和Dave Pawson开发，是最早的REST框架，先于JAX-RS出现。</p>
<p>好的，前面介绍了一些构建REST服务的背景，我们下面使用Apache CXF来完成REST服务的构建。<br />
因为Aapche CXF是高依赖于Spring的，我们也用到了Spring。<br />
（其实Spring也有自己的REST支持，不过具体是通过什么支持，还没有了解，以后有机会比较一下和本文采用方式的区别）。</p>
<h2>Step 1. 基本源代码</h2>
<p>在这个Demo中，我们假设系统中有一些用户的信息，我们定义一个User实体类。然后开放REST接口，通过REST服务的方式对系统中的User进行CRUD
(Create, Read, Update, Delete)操作。</p>
<h3>Model层</h3>
<p>定义User实体类，是一个简单的POJO</p>
<p><em>User.java</em>  </p>
<div class="highlight"><pre><span class="kn">package</span> <span class="n">info</span><span class="o">.</span><span class="na">sanween</span><span class="o">.</span><span class="na">demo</span><span class="o">.</span><span class="na">rest</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">birthDate</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">city</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">state</span><span class="o">;</span>

    <span class="cm">/*省略setters和getters方法*/</span>
<span class="o">}</span>
</pre></div>


<h3>Service层</h3>
<p>为了例子的简单，我们没有定义Dao层，直接将User信息存放在内存中。</p>
<p><strong>定义JAX-RS Service类，在类名上使用@Path注解</strong>。（该类是可以通过CXF暴露给外界的Service类）。<br />
<em>有关该类中的注解说明 以及POST,PUT,GET,DELETE对应的CRUD操作，请了解JAX-RS规范。</em></p>
<p><em>UserManager.java</em>  </p>
<div class="highlight"><pre><span class="kn">package</span> <span class="n">info</span><span class="o">.</span><span class="na">sanween</span><span class="o">.</span><span class="na">demo</span><span class="o">.</span><span class="na">rest</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">info.sanween.demo.rest.model.User</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.ws.rs.Consumes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.DELETE</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.GET</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.POST</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.PUT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.Path</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.PathParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.Produces</span><span class="o">;</span>

<span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/users&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserManager</span> <span class="o">{</span>

    <span class="c1">//创建用户使用POST,需要创建的用户信息在HTTP的请求中说明</span>
    <span class="nd">@POST</span>
    <span class="nd">@Consumes</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">)</span>
    <span class="nd">@Produces</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>

    <span class="c1">//读取用户使用GET,请求中带id</span>
    <span class="nd">@GET</span>
    <span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;{id}&quot;</span><span class="o">)</span>
    <span class="nd">@Consumes</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">)</span>
    <span class="nd">@Produces</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">readUser</span><span class="o">(</span><span class="nd">@PathParam</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">);</span>

    <span class="c1">//更新用户使用PUT,请求中带id,需要更新的用户信息在HTTP的请求中说明</span>
    <span class="nd">@PUT</span>
    <span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;{id}&quot;</span><span class="o">)</span>
    <span class="nd">@Consumes</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">)</span>
    <span class="nd">@Produces</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateUser</span><span class="o">(</span><span class="nd">@PathParam</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="n">User</span> <span class="n">user</span><span class="o">);</span>

    <span class="c1">//删除用户使用DELETE,请求中带id</span>
    <span class="nd">@DELETE</span>
    <span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;{id}&quot;</span><span class="o">)</span>
    <span class="nd">@Consumes</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">)</span>
    <span class="nd">@Produces</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteUser</span><span class="o">(</span><span class="nd">@PathParam</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>


<p>实现上面的Service  </p>
<p><em>UserManagerService.java</em>  </p>
<div class="highlight"><pre><span class="kn">package</span> <span class="n">info</span><span class="o">.</span><span class="na">sanween</span><span class="o">.</span><span class="na">demo</span><span class="o">.</span><span class="na">rest</span><span class="o">.</span><span class="na">service</span><span class="o">.</span><span class="na">impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ConcurrentHashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.atomic.AtomicInteger</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.ws.rs.WebApplicationException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.ws.rs.core.Response</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">info.sanween.demo.rest.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">info.sanween.demo.rest.service.UserManager</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserManagerService</span> <span class="kd">implements</span> <span class="n">UserManager</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">User</span><span class="o">&gt;</span> <span class="n">userDB</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">User</span><span class="o">&gt;();</span>
    <span class="kd">private</span> <span class="n">AtomicInteger</span> <span class="n">idCounter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO Auto-generated method stub</span>
        <span class="n">Integer</span> <span class="n">id</span> <span class="o">=</span> <span class="n">idCounter</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">();</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">userDB</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Created user &quot;</span> <span class="o">+</span> <span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">readUser</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO Auto-generated method stub</span>
        <span class="kd">final</span> <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userDB</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">user</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">WebApplicationException</span><span class="o">(</span><span class="n">Response</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateUser</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO Auto-generated method stub</span>
        <span class="n">User</span> <span class="n">current</span> <span class="o">=</span> <span class="n">userDB</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">current</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">WebApplicationException</span><span class="o">(</span><span class="n">Response</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">);</span>
        <span class="n">current</span><span class="o">.</span><span class="na">setBirthDate</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getBirthDate</span><span class="o">());</span>
        <span class="n">current</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="n">current</span><span class="o">.</span><span class="na">setCity</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getCity</span><span class="o">());</span>
        <span class="n">current</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getEmail</span><span class="o">());</span>
        <span class="n">current</span><span class="o">.</span><span class="na">setState</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteUser</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO Auto-generated method stub</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userDB</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">user</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">WebApplicationException</span><span class="o">(</span><span class="n">Response</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">);</span>
        <span class="n">userDB</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>上面的代码中，我们将User数据信息直接放置在内存之中。</p>
<h2>Step 2. 配置文件</h2>
<p>好了，到目前为止。我们所需要编写的代码都已经完成了。接下来就是使用Spring和CXF调用这些代码。</p>
<p>在WEB-INF目录下创建rest-context.xml文件。在该配置文件中，定义REST的配置内容</p>
<p><em>rest-content.xml</em>  </p>
<div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xmlns:cxf=</span><span class="s">&quot;http://cxf.apache.org/core&quot;</span>
    <span class="na">xmlns:jaxws=</span><span class="s">&quot;http://cxf.apache.org/jaxws&quot;</span> <span class="na">xmlns:jaxrs=</span><span class="s">&quot;http://cxf.apache.org/jaxrs&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">            http://cxf.apache.org/core http://cxf.apache.org/schemas/core.xsd</span>
<span class="s">            http://www.springframework.org/schema/beans </span>
<span class="s">            http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">            http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd</span>
<span class="s">            http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- 添加cxf的配置文件 --&gt;</span>
    <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:META-INF/cxf/cxf.xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;classpath:META-INF/cxf/cxf-servlet.xml&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- 创建一个jsonProvider给jaxrs:server元素使用 --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;jsonProvider&quot;</span> <span class="na">class=</span><span class="s">&quot;org.codehaus.jackson.jaxrs.JacksonJsonProvider&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- 暴露我们将要提供的Rest服务 --&gt;</span>
    <span class="nt">&lt;jaxrs:server</span> <span class="na">id=</span><span class="s">&quot;userManagerREST&quot;</span> <span class="na">address=</span><span class="s">&quot;/rest/UserManager&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;jaxrs:serviceBeans&gt;</span>
            <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;userManagerService&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/jaxrs:serviceBeans&gt;</span>
        <span class="nt">&lt;jaxrs:providers&gt;</span>
            <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&#39;jsonProvider&#39;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/jaxrs:providers&gt;</span>
    <span class="nt">&lt;/jaxrs:server&gt;</span>

    <span class="c">&lt;!-- 这里定义我们所编写的Bean，你也可以使用注解的方式管理bean --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;userManagerService&quot;</span> <span class="na">class=</span><span class="s">&quot;info.sanween.demo.rest.service.impl.UserManagerService&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>


<p>注意：使用<code>&lt;jaxrs:server&gt;</code>元素来暴露我们想要对外提供的接口。并注意其"address"属性，这是访问我们这个接口的路径。</p>
<p>接下来，我们在web.xml中声明使用Spring和定义CXF Servlet。</p>
<p><em>web.xml</em></p>
<div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">version=</span><span class="s">&quot;3.0&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee </span>
<span class="s">    http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
    <span class="na">metadata-complete=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;display-name&gt;</span>RestDemo<span class="nt">&lt;/display-name&gt;</span>
    <span class="nt">&lt;description&gt;</span>RestDemo<span class="nt">&lt;/description&gt;</span>

    <span class="c">&lt;!-- begin Spring --&gt;</span>
    <span class="nt">&lt;context-param&gt;</span>
        <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
        <span class="nt">&lt;param-value&gt;</span>/WEB-INF/*-context.xml<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/context-param&gt;</span>

    <span class="nt">&lt;listener&gt;</span>
        <span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
    <span class="nt">&lt;/listener&gt;</span>
    <span class="c">&lt;!-- end Spring --&gt;</span>

    <span class="c">&lt;!-- 使用CXF servlet --&gt;</span>
    <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>CXFServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>org.apache.cxf.transport.servlet.CXFServlet<span class="nt">&lt;/servlet-class&gt;</span>
        <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
    <span class="nt">&lt;/servlet&gt;</span>

    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>CXFServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/services/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span>
    <span class="c">&lt;!-- end CXF --&gt;</span>
<span class="nt">&lt;/web-app&gt;</span>
</pre></div>


<p>在web.xml中，</p>
<div class="highlight"><pre><span class="nt">&lt;context-param&gt;</span>
    <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
    <span class="nt">&lt;param-value&gt;</span>/WEB-INF/*-context.xml<span class="nt">&lt;/param-value&gt;</span>
<span class="nt">&lt;/context-param&gt;</span>
<span class="nt">&lt;listener&gt;</span>
    <span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
<span class="nt">&lt;/listener&gt;</span>
</pre></div>


<p>这是最基本的声明Spring的方式。在这个例子中，我们使用了通配符<code>/WEB-INF/*-context.xml</code>来加载我们所需要的spring配置文件。<br />
你可以按照通配符的格式定义不同的Spring配置文件，方便管理。</p>
<div class="highlight"><pre><span class="nt">&lt;servlet&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>CXFServlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;servlet-class&gt;</span>org.apache.cxf.transport.servlet.CXFServlet<span class="nt">&lt;/servlet-class&gt;</span>
    <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
<span class="nt">&lt;/servlet&gt;</span>
<span class="nt">&lt;servlet-mapping&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>CXFServlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/services/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/servlet-mapping&gt;</span>
</pre></div>


<p>这一段声明了CXFServlet，用来映射来自/services/*的url，使用REST的方式来处理。</p>
<p>通过这一系列的配置。反过来就可以得到各个REST接口所对应的url路径。</p>
<p>例如，<strong>GET http://localhost:8080/RestDemo/services/rest/UserManager/users/{id}</strong><br />
就会调用UserManagerService类的readUser()方法
就可以获取id为{id}的用户的信息。</p>
<h2>step 3. 测试</h2>
<p>我们使用Chrome的扩展应用<a href="https://chrome.google.com/webstore/detail/advanced-rest-client/hgmloofddffdnphfgcellkdfbfbjeloo">Advanced Rest Client</a>
来模拟HTTP通信和测试。
Advanced Rest Client 界面如下:  </p>
<p><img alt="advanced rest client" src="http://d.pr/i/khAv+" /></p>
<p>在上图中，我们创建一个user用户。<br />
地址栏填写请求Rest服务的url地址: http://localhost:8080/RestDemo/services/rest/UserManager/users/<br />
因为是创建用户，下面的请求方法选择POST<br />
再下面是设置你的请求Header信息，如"Content-Type"，这里我们留空<br />
接着是payload，我们填写一个josn格式的用户，将会被包含在请求中。  </p>
<div class="highlight"><pre><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Rocky&quot;</span><span class="p">,</span><span class="s2">&quot;email&quot;</span><span class="o">:</span><span class="s2">&quot;someting@nospam.org&quot;</span><span class="p">,</span><span class="s2">&quot;birthDate&quot;</span><span class="o">:</span><span class="s2">&quot;1975-01-01&quot;</span><span class="p">,</span><span class="s2">&quot;city&quot;</span><span class="o">:</span><span class="s2">&quot;Omaha&quot;</span><span class="p">,</span><span class="s2">&quot;state&quot;</span><span class="o">:</span><span class="s2">&quot;CN&quot;</span><span class="p">}</span>
</pre></div>


<p>再下面我们选择数据格式为"application/json"。<br />
然后点击Send。<br />
下面出现了请求的结果，因为我们服务器端在createUser成功后没有返回，所以REST返回的状态吗是204  </p>
<blockquote>
<p>Status Code: 204 - No Content </p>
<p>The server successfully processed the request, but is not returning any content.</p>
</blockquote>
<p>我们再使用GET获取刚刚创建的用户信息(刚刚创建的用户id为1)  </p>
<p><img alt="get user 1" src="http://d.pr/i/ENhC+" /></p>
<p>点击Send之后结果如下：<br />
<img alt="result of user 1" src="http://d.pr/i/91Pp+" /></p>
<p>可以看到返回 200状态<br />
在返回的结果中，有user 1的信息。  </p>
<p><strong>注意：</strong> 
我们声明readUser()的时候，返回值是User对象，而为什么这里response返回了josn格式的用户信息呢？  <br />
因为我们使用了JsonProvider。</p>
<div class="highlight"><pre><span class="c">&lt;!-- 创建一个jsonProvider给jaxrs:server元素使用 --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;jsonProvider&quot;</span> <span class="na">class=</span><span class="s">&quot;org.codehaus.jackson.jaxrs.JacksonJsonProvider&quot;</span> <span class="nt">/&gt;</span>

<span class="c">&lt;!-- 暴露我们将要提供的Rest服务 --&gt;</span>
<span class="nt">&lt;jaxrs:server</span> <span class="na">id=</span><span class="s">&quot;userManagerREST&quot;</span> <span class="na">address=</span><span class="s">&quot;/rest/UserManager&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;jaxrs:serviceBeans&gt;</span>
        <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;userManagerService&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/jaxrs:serviceBeans&gt;</span>
    <span class="nt">&lt;jaxrs:providers&gt;</span>
        <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&#39;jsonProvider&#39;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/jaxrs:providers&gt;</span>
<span class="nt">&lt;/jaxrs:server&gt;</span>
</pre></div>


<p>jsonProvider自动将请求中json格式的User参数，变为User对象，传递给createUser(User user)作为参数。<br />
而将User readUser()的结果转化成json格式响应给客户端。。</p>                </article>
<p class="paginator">
    Page 1 / 1
</p>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>