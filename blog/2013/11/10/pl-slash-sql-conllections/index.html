
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>pl/sql conllections - Sanween's Blog</title>
  <meta name="author" content="sanween">

  
  <meta name="description" content="PL/SQL 中的集合类型 PL/SQL 中有三种集合类型：Varrays, Nested tables, Associative arrays. Varrays: 拥有固定的长度（虽说在运行时中可以改变），使用连续的数字作为下标。类似Java语言中的数组，定长。
Nested tables: &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yinsanwen.github.io/blog/2013/11/10/pl-slash-sql-conllections/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Sanween's Blog" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">coding</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">Sanween's Blog</a></h1>
  
    <h2>坚持，沉淀，学习，记录</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:yinsanwen.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">Pl/sql Conllections</h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-10T10:20:00+08:00" pubdate data-updated="true">Nov 10<span>th</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h1>PL/SQL 中的集合类型</h1>

<p>PL/SQL 中有三种集合类型：<code>Varrays</code>, <code>Nested tables</code>, <code>Associative arrays</code>.</p>

<ul>
<li>Varrays: 拥有固定的长度（虽说在运行时中可以改变），使用连续的数字作为下标。<em>类似Java语言中的数组，定长。</em></li>
<li>Nested tables: 可以拥有任意数量的元素，使用连续的数字作为下标。<em>类似Java语言中的List类型。</em></li>
<li>Associative arrays，又叫做<code>Index-by tables</code>。可以使用任意的数字或者字符串作为下标。<em>类似Java语言中的Map数据结构</em></li>
</ul>


<!-- more -->


<p>Associative arrays<strong>默认按索引的字母顺序排序</strong>(alphabetically)。</p>

<figure class='code'><figcaption><span>title:字符串索引默认用字母顺序排序 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">DECLARE</span>  <span class="k">TYPE</span> <span class="n">population_type</span> <span class="k">IS</span> <span class="k">TABLE</span> <span class="k">OF</span> <span class="nb">NUMBER</span> <span class="k">INDEX</span> <span class="k">BY</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">64</span><span class="p">);</span>
</span><span class='line'>  <span class="n">country_population</span> <span class="n">population_type</span><span class="p">;</span>
</span><span class='line'>  <span class="n">continent_population</span> <span class="n">population_type</span><span class="p">;</span>
</span><span class='line'>  <span class="n">howmany</span> <span class="nb">NUMBER</span><span class="p">;</span>
</span><span class='line'>  <span class="n">which</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">64</span><span class="p">);</span>
</span><span class='line'><span class="k">BEGIN</span>
</span><span class='line'>  <span class="n">country_population</span><span class="p">(</span><span class="s1">&#39;Greenland&#39;</span><span class="p">)</span> <span class="p">:</span><span class="o">=</span> <span class="mi">100000</span><span class="p">;</span> <span class="c1">-- Creates new entry</span>
</span><span class='line'>  <span class="n">country_population</span><span class="p">(</span><span class="s1">&#39;Iceland&#39;</span><span class="p">)</span> <span class="p">:</span><span class="o">=</span> <span class="mi">750000</span><span class="p">;</span>   <span class="c1">-- Creates new entry</span>
</span><span class='line'><span class="c1">-- Looks up value associated with a string</span>
</span><span class='line'>  <span class="n">howmany</span> <span class="p">:</span><span class="o">=</span> <span class="n">country_population</span><span class="p">(</span><span class="s1">&#39;Greenland&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">continent_population</span><span class="p">(</span><span class="s1">&#39;Australia&#39;</span><span class="p">)</span> <span class="p">:</span><span class="o">=</span> <span class="mi">30000000</span><span class="p">;</span>
</span><span class='line'>  <span class="n">continent_population</span><span class="p">(</span><span class="s1">&#39;Antarctica&#39;</span><span class="p">)</span> <span class="p">:</span><span class="o">=</span> <span class="mi">1000</span><span class="p">;</span> <span class="c1">-- Creates new entry</span>
</span><span class='line'>  <span class="n">continent_population</span><span class="p">(</span><span class="s1">&#39;Antarctica&#39;</span><span class="p">)</span> <span class="p">:</span><span class="o">=</span> <span class="mi">1001</span><span class="p">;</span> <span class="c1">-- Replaces previous value </span>
</span><span class='line'><span class="c1">-- Returns &#39;Antarctica&#39; as that comes first alphabetically.</span>
</span><span class='line'>  <span class="n">which</span> <span class="p">:</span><span class="o">=</span> <span class="n">continent_population</span><span class="p">.</span><span class="k">FIRST</span><span class="p">;</span>
</span><span class='line'><span class="c1">-- Returns &#39;Australia&#39; as that comes last alphabetically.  which := continent_population.LAST;</span>
</span><span class='line'><span class="c1">-- Returns the value corresponding to the last key, in this</span>
</span><span class='line'><span class="c1">-- case the population of Australia.</span>
</span><span class='line'>  <span class="n">howmany</span> <span class="p">:</span><span class="o">=</span> <span class="n">continent_population</span><span class="p">(</span><span class="n">continent_population</span><span class="p">.</span><span class="k">LAST</span><span class="p">);</span>
</span><span class='line'><span class="k">END</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>title:数字索引默认数字大小排序 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">DECLARE</span>
</span><span class='line'>  <span class="k">TYPE</span> <span class="n">number_index_table</span> <span class="k">IS</span> <span class="k">TABLE</span> <span class="k">OF</span> <span class="nb">NUMBER</span> <span class="k">INDEX</span> <span class="k">BY</span> <span class="n">PLS_INTEGER</span><span class="p">;</span>
</span><span class='line'>  <span class="n">num_tab</span> <span class="n">number_index_table</span> <span class="p">;</span>
</span><span class='line'>  <span class="n">which</span> <span class="nb">integer</span><span class="p">;</span>
</span><span class='line'><span class="k">BEGIN</span>
</span><span class='line'>  <span class="n">num_tab</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span> <span class="p">:</span><span class="o">=</span> <span class="mi">111</span><span class="p">;</span>
</span><span class='line'>  <span class="n">num_tab</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span> <span class="p">:</span><span class="o">=</span> <span class="mi">111</span><span class="p">;</span>
</span><span class='line'>  <span class="n">num_tab</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="p">:</span><span class="o">=</span> <span class="mi">111</span><span class="p">;</span>
</span><span class='line'>  <span class="n">num_tab</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span> <span class="p">:</span><span class="o">=</span> <span class="mi">111</span><span class="p">;</span>
</span><span class='line'>  <span class="n">num_tab</span><span class="p">(</span><span class="mi">333</span><span class="p">)</span> <span class="p">:</span><span class="o">=</span> <span class="mi">111</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">--loop num_tab</span>
</span><span class='line'>  <span class="n">which</span> <span class="p">:</span><span class="o">=</span> <span class="n">num_tab</span><span class="p">.</span><span class="k">FIRST</span><span class="p">;</span>
</span><span class='line'>  <span class="n">while</span> <span class="n">which</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span>
</span><span class='line'>  <span class="n">loop</span>
</span><span class='line'>     <span class="n">DBMS_OUTPUT</span><span class="p">.</span><span class="n">PUT_LINE</span><span class="p">(</span><span class="n">which</span><span class="o">||</span><span class="s1">&#39;-&gt;&#39;</span><span class="o">||</span><span class="n">num_tab</span><span class="p">(</span><span class="n">which</span><span class="p">));</span>
</span><span class='line'>     <span class="n">which</span> <span class="p">:</span><span class="o">=</span> <span class="n">num_tab</span><span class="p">.</span><span class="k">NEXT</span><span class="p">(</span><span class="n">which</span><span class="p">);</span>
</span><span class='line'>  <span class="k">end</span> <span class="n">loop</span><span class="p">;</span>
</span><span class='line'><span class="k">END</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>输出</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>11-&gt;111
</span><span class='line'>22-&gt;111
</span><span class='line'>111-&gt;111
</span><span class='line'>222-&gt;111
</span><span class='line'>333-&gt;111
</span></code></pre></td></tr></table></div></figure>


<h2>Collection的方法</h2>

<p>前面使用了<code>First</code>,<code>Last</code>,<code>Next</code>等集合的方法。集合的方法一共包括</p>

<blockquote><p>COUNT, DELETE, EXISTS, EXTEND, FIRST, LAST, LIMIT, NEXT, PRIOR, and TRIM.</p></blockquote>

<h3>需要注意的是:</h3>

<ul>
<li>集合的方法不能用在SQL语句中</li>
<li>EXTEND 和 TRIM 不能用于Associative arrays</li>
<li>EXISTS, COUNT, LIMIT, FIRST, LAST, PRIOR, 和 NEXT是函数；而EXTEND, TRIM, DELETE 是存储过程</li>
<li>EXISTS, PRIOR, NEXT, TRIM, EXTEND, DELETE 带有表示下标的参数。 一般情况下下标都是数字，在Associative arrays中可以使字符串</li>
</ul>


<h3>下面对这些方法或是过程做些说明</h3>

<ul>
<li><strong>EXISTS(n)</strong> : returns TRUE if the nth element in a collection exists.</li>
<li><strong>COUNT</strong> : returns the number of elements that a collection currently contains.</li>
<li><strong>LIMIT</strong> : 返回集合的最大容量。对于nested table 和associative arrays，没有固定的容量大小，返回NULL。对于Varrays，返回其容量大小。</li>
<li><strong>FIRST</strong> : 返回集合的第一个（最小的）索引（下标），<br/>
<strong>LAST</strong> : 返回最后一个（最大的)索引（下标）。</li>
<li><strong>PRIOR(n)</strong> : 返回索引n的前一个索引，  如果n是第一个索引，返回null；<br/>
<strong>NEXT(n)</strong> : 返回索引n的下一个索引，如果n是最后一个索引，返回null。</li>
<li><strong>EXTEND</strong> : 增加集合的长度，对varray和nested array使用。有三种形式

<ul>
<li>EXTEND 在集合末尾增加一个Null元素</li>
<li>EXTEND(n) 在集合末尾增加n个Null元素</li>
<li>EXTEND(n,i) 将集合的第i个元素的值复制n份到集合的末尾。<br/>
不能对index-by tables 使用extend。不能对未初始化的集合使用extend。</li>
</ul>
</li>
<li><strong>TRIM</strong> : 减少集合的容量，有两种形式

<ul>
<li>TRIM 除去集合末尾的最后一个元素</li>
<li>TRIM(n) 除去集合末尾的n个元素。<br/>
如果想删除所有的元素，使用不带参数的DELETE</li>
</ul>
</li>
<li><strong>DELETE</strong> : 删除集合中的元素，有三种形式

<ul>
<li>DELETE 不带参数，删除集合中所有元素</li>
<li>DELETE(n) 删除下标为n的元素</li>
<li>DELETE(m,n) 删除所有下标在m&hellip;n之间的元素</li>
</ul>
</li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">sanween</span></span>

      








  


<time datetime="2013-11-10T10:20:00+08:00" pubdate data-updated="true">Nov 10<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/database/'>database</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://yinsanwen.github.io/blog/2013/11/10/pl-slash-sql-conllections/" data-via="" data-counturl="http://yinsanwen.github.io/blog/2013/11/10/pl-slash-sql-conllections/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left articlenav" href="/blog/2013/10/26/java-method-default-param/" title="Previous Post: Java中默认参数的实现——使用方法的重载">&laquo; Java中默认参数的实现——使用方法的重载</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/11/10/pl-slash-sql-conllections/">Pl/sql Conllections</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/26/java-method-default-param/">Java中默认参数的实现——使用方法的重载</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/14/new-start/">New Start</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - sanween -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sanween';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://yinsanwen.github.io/blog/2013/11/10/pl-slash-sql-conllections/';
        var disqus_url = 'http://yinsanwen.github.io/blog/2013/11/10/pl-slash-sql-conllections/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
